#!/usr/bin/env ruby

require 'date'
require 'google_drive'

class Date
  def weekend?
    saturday? or sunday?
  end
end

class Timesheet
  DEFAULT_PATH = 'timesheet'

  def initialize(h={:configfile => "#{ENV['HOME']}/.timesheet.yml"})
    @config = YAML.load File.read h[:configfile] # TODO: not from file
  end

  def connect
    @google_drive = GoogleDrive.login(@config[:username], @config[:password])
  end

  def method_missing(id, *args, &blk)
    @google_drive.send id, *args, &blk
  end
end

begin
  d = Date.parse ARGV.join ' '
rescue ArgumentError
  d = Date.parse Date.today.strftime "%Y-%m-01" # this month, 1st day
end

m = d.month

timesheet = Timesheet.new
timesheet.connect
worksheet = timesheet.file_by_title(Timesheet::DEFAULT_PATH).worksheets[0]

row = 1
col = 1

while (d.month == m) do
  p d
  if d.weekend?
    # your code
  else
    worksheet[row, col] = d
  end
  d   += 1
  row += 1
end

worksheet.save



